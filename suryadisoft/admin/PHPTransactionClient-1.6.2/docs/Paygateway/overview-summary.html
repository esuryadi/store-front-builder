<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<!--NewPage-->
<HTML>
	<HEAD>
		<TITLE>PHP Transaction Client v1.6.1: Overview </TITLE>
		<!-- Generated by javadoc on Tue Oct 31 09:57:58 PST 2000 -->
		<LINK REL="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
	</HEAD>
	<BODY BGCOLOR="white">
		<!-- ========== START OF NAVBAR ========== -->
		<A NAME="navbar_top"><!-- --></A>
		<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
			<TR>
				
    <TD ALIGN="right" VALIGN="top" ROWSPAN="3"><EM> <b><i>PHP&nbsp;Transaction 
      Client v1.6.1 API Specification</i></b></EM> </TD>
			</TR>
		</TABLE>
		<!-- =========== END OF NAVBAR =========== -->
		<HR>
		<CENTER>
  <H2>Overview of the&nbsp;PHP Transaction Client v1.6.1</H2>
		</CENTER>
		
<A NAME="overview_description"> 
<!-- -->
</A> For installation instructions, click <a href="../install.html">here</a>.
<h3>
				I. Introduction
			</h3>
		<P></P>
		
<P> The <i>PHP Transaction Client</i> allows merchants to efficiently and easily 
  conduct transactions over the Internet. The&nbsp;<EM>PHP Transaction Client</EM> 
  is a network client. It communicates with the <i>Transaction Server</i> by sending 
  transaction requests to it and receiving transaction responses from it. The 
  <i>Transaction Server</i> is responsible for transaction processing, which involves 
  a number of steps including authentication, business logic, and communication 
  with the financial entities involved. </P>
		<h3>
			II. Basic Architecture
		</h3>
		
<P> Any transaction consists of two simple parts: a request and a response. These 
  two components are represented by the following classes: <A HREF="TransactionRequest.html"> 
  <CODE>TransactionRequest</CODE></A>, <A HREF="TransactionResponse.html"><CODE>TransactionResponse</CODE></A>.
<P> For the merchant system using the <i>PHP Transaction Client</i>, performing 
  a transaction is as simple as the following three steps. 
<ol>
				
  <li> Create a <a href="TransactionRequest.html"><code>TransactionRequest</code></a> 
    object based on transaction-specific data. 
  <li>Call a method of the <a href="TransactionRequest.html"><code>TransactionRequest</code></a> 
    object to perform the actual transaction. This will be either <a href="TransactionRequest.html#doTransaction"><code>TransactionRequest.doTransaction()</code></a> 
    or <a href="TransactionRequest.html#doBatchTransaction"><code>TransactionRequest.doBatchTransaction()</code></a> 
    depending on what transaction type is desired. 
  <li> Receive the <a href="TransactionResponse.html"><code>TransactionResponse</code></a> 
    returned by <a href="TransactionRequest.html#doTransaction"><code>doTransaction()</code></a> 
    or <a href="TransactionRequest.html#doTransaction"><code>doBatchTransaction()</code></a>.</li>
			</ol>
			That is all there is to it. At this point, the transaction has been completed. 
			Of course, at this point the merchant system must respond appropriately to the 
			success or failure of the transaction, such as by recording the transaction for 
			the merchant's records and informing the customer of the result.
			<h3>
				III. Transaction Flow
			</h3>
		
<P> As described in II. Basic Architecture, the <i>PHP Transaction Client</i> 
  provides a simple-as-possible entry point into transaction processing. It enables 
  merchants to easily integrate their systems, existing or not, with an online 
  payment solution. All that is required is to create a TransactionRequest, complete 
  the transaction by calling doTransaction(), and receive and react appropriately 
  to the TransactionResponse. Nevertheless, it is important for the merchant to 
  have some understanding of the transaction flow that underlies the transaction 
  processing that occurs during a call to doTransaction(). This understanding 
  will allow the merchant to react appropriately to errors, so that any problem 
  will be solved as quickly as possible. Specifically, an understanding of the 
  transaction flow will, for example, help a merchant to: 
<ul>
				
  <li> Decide whether a transaction failure is due to a problem with a transaction 
    (e.g. a payment that cannot be authorized) or is due to a problem with the 
    transaction processing system (e.g. the financial institution's connection 
    to the Internet is temporarily down). 
  <li>
				Determine if the problem is caused by the merchant system and help resolve what 
				changes need to be made to fix the problem.
				<li>
				If the problem is caused by the transaction processing system, determine if it 
				is temporary or requires a fix, and at what stage of the processing did the 
				problem occur.
				
  <li> Decide how to inform the customer of the problem. (E.g. To try a different 
    payment method, or to retry the transaction in a minute or two.)</li>
			</ul>
			The processing of a transaction begins with the <i>PHP Transaction 
Client</i>, which passes a TransactionRequest to the <i>Transaction Server</i> 
. Transaction flow then involves several other entities, as illustrated in Figure 
1, below. 
<P></P>
		<P>
			<table align="center" width="100%">
				<tr>
					<td align="middle"><img src="doc-files/transaction_flow.gif"></td>
				</tr>
			</table>
		<p></P>
		<P>
			<font size="2"><b>Figure 1. Transaction Flow.</b> The flow of transaction 
				information that occurs during a call to doTransaction().</font>
		</P>
		<h3>
			IV. Merchant Integration
		</h3>
		
<P> The flexibility of the <i>PHP Transaction Client</i> allows it to be integrated 
  into many different kinds of merchant systems. A typical merchant web-site might, 
  for example, use an HTML page which posts to a PHP page, each built by the merchant. 
  A typical PHP page would perform the following steps:
<ol>
  <li> Receive an HTTP POST, sent by a customer clicking the "Buy-button" on the 
    merchant order-page. The POST might contain transaction information from a 
    web-form filled in by the customer. 
  <li> Use the information from the HTTP POST to create a <a href="TransactionRequest.html"><code>TransactionRequest</code></a>. 
  <li> Call <a href="TransactionRequest.html#doTransaction"><code>doTransaction()</code></a> 
    and receive the returned <a href="TransactionResponse.html"><code>TransactionResponse</code></a>. 
  <li> Check the response code of the <a href="TransactionResponse.html"><code>TransactionResponse</code></a>. 
  <li> Based on the response code, make an appropriate record in the merchant's 
    system (e.g. the merchant's order tracking system). 
  <li> Based on the response code, return an appropriate HTML page (e.g. a receipt 
    or an error page) as an HTTP response to the customer.</li>
</ol>
		<P></P>
		
<h3> V. Built In Constants</h3>
		
<P> There are several constants built into the <CODE>Paygateway.php</CODE> module 
  that are useful for performing transactions.</P>
		
<h4>Response Codes</h4>
		
<P> Each TransactionResponse object contains a single response code, which is 
  extracted from the TransactionResponse by calling its <A HREF="TransactionResponse.html#getResponseCode()"> 
  <CODE>getResponseCode()</CODE></A> method. The codes are integer values.</P>
		
<P> The response code constants define all permissible response codes. The meaning 
  of this integer value is determined by comparing it to the constants. The response 
  code of a TransactionResponse indicates either (i) that the transaction was 
  successful, or, if the transaction failed, (ii) the point of failure. The point 
  of transaction failure may be any of the entities shown in Figure 1. The response 
  code constants begin with <CODE>RC_</CODE>. For a complete list with their meanings, 
  see <a href="ResponseCodes.html">Response Codes</a>.</P>
<P> In addition to a response code, which gives a general category of transaction 
  result, each TransactionResponse also contains a textual description that gives 
  detailed information about the result. This text is returned as a&nbsp;string 
  by the TransactionResponse's <A HREF="TransactionResponse.html#getResponseCodeText"> 
  <CODE>getResponseCodeText()</CODE></A> method. The merchant should use response 
  code text in conjunction with the response code. </P>
		
<P> The merchant system should use the response code and response code text to 
  determine the appropriate course of action after receiving a <a href="TransactionResponse.html"><code>TransactionResponse</code></a>. 
  In particular, the merchant system should use them to: 
<ul>
				<li>
					Determine the <i>type</i>
				of response (e.g. receipt or error-page) to return to the customer.
				<li>
					Determine the <i>exact content</i>
				of the response to return to the customer or to record in an error-log. (E.g. 
				Use the response code text.)
				<li>
					Determine what type of record to make in the merchant's system (e.g. the 
					order-tracking system).</li>
			</ul>
		Furthermore, the merchant's developer should use the response codes to 
help in resolve the cause of errors during system development and maintenance. 
For instance, the response code will immediately help the developer to determine 
if they have neglected to include a required field in a TransactionRequest or 
to determining if they have incorrectly formatted a field in a TransactionRequest. 
<h4>Country Codes</h4>
		
<P> There are constants defined in the file <code>CountryCodes.php</code> for use with the 
  <a href="TransactionRequest.html#setBillCountryCode"><code>TransactionRequest.setBillCountryCode()</code></a> 
  and <a href="TransactionRequest.html#setShipCountryCode"><code>TransactionRequest.setShipCountryCode()</code></a> 
  methods These are simply a mapping of country names to their IS0-3166 country 
  codes. These codes are the only values that the <i>PHP Transaction Client</i> 
  will accept in its various country fields. For a listing of the country code 
  constants, see <a href="CountryCodes.html">Country Codes</a>.</P>
		<h3>
			VI. Transaction Types
		</h3>
		
<P> The <i>PHP Transaction Client</i> enables the merchant system to perform two 
  different types of transactions. It is key that the merchant system understand 
  the different transaction types and use the type that correctly corresponds 
  to the goal they want to achieve. </P>
		<P>
			Existing types are:
			
<OL>
  <li> Credit Card Request</li>
  <li> Batch Request</li>
</OL>
<p>Both of these transaction types can be performed by using the TransactionRequest 
  object. Credit card requests are performed by setting the appropriate fields 
  and then calling the <a href="TransactionRequest.html#doTransaction"><code>TransactionRequest.doTransaction()</code></a> 
  method. Batch Requests are performed by setting the appropriate fields and then 
  calling the <a href="TransactionRequest.html#doBatchTransaction"><code>TransactionRequest.doBatchTransaction()</code></a> 
  method. Both methods return a <a href="TransactionResponse.html"><code>TransactionResponse</code></a> 
  object which will be populated with information from whichever type of transaction 
  was processed.</p>
<P></P>
<P></P>
		
<h4> Credit Card Request</h4>
<P> The credit card request provides the merchant system with a means of performing 
  credit card transactions in which the <i>PHP Transaction Client</i> communicates 
  with the <i>Transaction Server</i> using SSL. This transaction flow does not 
  involve a wallet. The consumer submits their credit card information directly 
  to the merchant, who passes it to the PHP<i> Transaction Client</i>. </P>
<P>To perform a credit card request, you create a <a href="TransactionRequest.html"><code>TransactionRequest</code></a> 
  object and populate it with the <a href="RequiredFields.html">required fields</a> 
  and then call <a href="TransactionRequest.html#doTransaction"><code>doTransaction()</code></a>.</P>
		
<P> The following kinds of financial transactions can be performed:<br>
			<ul>
				
  <li> <b>Authorization:</b> Used to guarantee to the merchant that cardholder 
    funds are available to cover a transaction. The cardholder's issuer (that 
    is, the bank that issued the card) guarantees payment.<br>
					<br>
				<li>
					<b>Capture:</b> Used to actually make a payment. All payments must be 
					authorized and captured (although this work can be done at the same time by 
					doing a sale). Note that all payments are associated with a batch (see Void), 
					and that the <i>actual</i> capture occurs when the associated batch is closed.
					
    <P> Note that in many jurisdictions the laws require that the merchant performs 
      a capture only when an order is shipped. As a result, most transactions 
      (except for orders that are shipped immediately) should involve an initial 
      authorization at the time the order is places, followed by a subsequent 
      capture at the time the product is shipped. </P>
				<li>
					<b>Sale:</b> An authorization and a capture, combined into a single step.
					<br>
					<br>
				
  <li> <b>Void:</b> Reversing a capture (if applicable) and an authorization. 
    Only orders that have been authorized or captured but not closed can be voided. 
    An order becomes closed when the batch containing the order is processed. 
    In other words, voids cannot be performed after the associated batch has been 
    processed. Voids may also be used to reverse a credit before the batch containing 
    the credit has been closed. Note that different account types are configurable 
    on the Paygateway Payment Service. Some accounts support multiple payments 
    and credits for a single order number. In this case, in order to specify which 
    transaction is being voided, you can use the <code>VOID_AUTH</code>, <code>VOID_CAPTURE</code>, 
    and <code>VOID_CREDIT</code> charge types. For these three charge types, you 
    must specify the reference ID of the transaction to be reversed. See <code><a href="TransactionRequest.html#setReferenceID">TransactionRequest.setReferenceID()</a></code>.<br>
					<br>
				
  <li> <b>Credit:</b> Used to make a credit.<br>
				</li>
			</ul>
			Call the <A HREF="CreditCardRequest.html#setChargeType(java.lang.String)"><CODE>TranscationRequest.setChargeType()</CODE></A> 
method to specify the desired type of transaction. Pass in one of the following 
constants: 
<ul>
  <li><CODE>AUTH</CODE> to perform an authorization. 
  <li><CODE>CAPTURE</CODE> to perform a capture. 
  <li><CODE>SALE</CODE> to perform a sale. 
  <li><CODE>VOID</CODE> to perform a void. 
  <li><CODE>CREDIT</CODE> to perform a credit.</li>
  <li><CODE>VOID_AUTH</CODE> to void an authorization.</li>
  <li><CODE>VOID_CAPTURE</CODE> to void a capture.</li>
  <li><CODE>VOID_CREDIT</CODE> to void a credit.</li>
  <li><CODE>CREATE_ORDER</CODE> to create an order with no payments or credits.</li>
  <li><CODE>CANCEL_ORDER</CODE> to cancel an order.</li>
  <li><CODE>CLOSE_ORDER</CODE> to close an order.</li>
</ul>
<p><b>Example</b></p>
<p>The following example demonstrates the basic flow of an <code>AUTH</code> and 
  <code>CAPTURE</code>. This example does not check to see if each setter method 
  succeeds. When variables are used to set properties, each setter should be checked 
  for success. See the example in <code>doTransaction.php</code>.</p>
<code> $ccReq = new TransactionRequest();<br>
<br>
// Set required AUTH fields<br>
$ccReq->setCreditCardNumber("4242424242424242");<br>
$ccReq->setExpireMonth("10");<br>
$ccReq->setExpireYear("2004");<br>
$ccReq->setChargeType(AUTH);<br>
$ccReq->setChargeTotal("1.00");<br>
$ccReq->setBillFirstName("Alan");<br>
$ccReq->setBillLastName("Guth");<br>
$ccReq->setBillEmail("aguth@nowhere.com");<br>
<br>
$ccResponse = $ccReq->doTransaction();<br>
<br>
if($ccResponse &amp;&amp; $ccResponse->getResponseCode() == RC_SUCCESSFUL_TRANSACTION) 
{<br>
&nbsp;&nbsp;$ccReq = new TransactionRequest();<br>
<br>
&nbsp;&nbsp;// Set required CAPTURE fields<br>
&nbsp;&nbsp;$ccReq->setChargeType(CAPTURE);<br>
&nbsp;&nbsp;$ccReq->setChargeTotal("1.00");<br>
&nbsp;&nbsp;$ccReq->setOrderID($ccResponse->getOrderID());<br>
&nbsp;&nbsp;$ccReq->setReferenceID($ccResponse->getReferenceID());<br>
<br>
&nbsp;&nbsp;$ccResponse = $ccReq->doTransaction();<br>
<br>
&nbsp;&nbsp;if($ccResponse &amp;&amp; $ccResponse->getResponseCode() == RC_SUCCESSFUL_TRANSACTION) 
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;// Successful auth and capture.<br>
&nbsp;&nbsp;}<br>
}<br>
</code> 
<p></p>
<h4> Batch Request</h4>
<p>The batch request may or may not be available depending on the type of account 
  you have set up on the Paygateway Payment Service. The batch request provides 
  a way of closing batches, purging batches or querying credit and payment totals 
  within a batch. Your account may be configured to close batches automatically, 
  so the use of the batch request is usually not necessary for payment processing.</p>
<p>To perform a batch request, you create a <a href="TransactionRequest.html"><code>TransactionRequest</code></a> 
  object and populate it with the <a href="RequiredFields.html">required fields</a> 
  and then call <a href="TransactionRequest.html#doBatchTransaction"><code>doBatchTransaction()</code></a>.</p>
<p>Call the <a href="TransactionRequest.html#setAction"><code>TransactionRequest.setAction()</code></a> 
  method to specify the desired batch action. Pass in one of the following constants.</p>
<ul>
  <li><CODE>SETTLE</CODE> to close the open batch. 
  <li><CODE>PURGE</CODE> to void all credits and payments in the open batch. 
  <li><CODE>TOTALS</CODE> to query the payment and credit totals for a batch. 
</ul>
<p><b>Example</b></p>
<code> $batchReq = new TransactionRequest();<br>
$batchReq->setAction(SETTLE);<br>
<br>
$batchResponse = $batchReq->doBatchTransaction();<br>
<br>
if($batchResponse &amp;&amp; $batchResponse->getResponseCode() == RC_SUCCESSFUL_TRANSACTION) 
{<br>
&nbsp;&nbsp;// Successful batch settlement<br>
}<br>
</code> 
<h3>VII. Required Fields</h3>
<p>Each transaction type has different required fields. They are listed <a href="RequiredFields.html">here</a>.</p>
<p>&nbsp;</p>
</BODY>
</HTML>
